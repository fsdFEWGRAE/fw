<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>GLOM Authorization</title>
<style>
body { background:#000; color:#fff; font-family:Arial }
.card { border:1px solid #333; padding:15px; margin:10px }
button { background:#b00000; color:#fff; border:none; padding:6px 12px }
.hidden { display:none }
</style>
</head>
<body>

<h2>GLOM Authorization Panel</h2>

<div id="loginCard" class="card">
  <input id="user" placeholder="Username"><br><br>
  <input id="pass" type="password" placeholder="Password"><br><br>
  <input id="totp" placeholder="2FA (if enabled)"><br><br>
  <button onclick="login()">Login</button>
</div>

<div id="dashboard" class="hidden">
  <div class="card">
    <span id="uName"></span> | <span id="uRole"></span>
    <button onclick="logout()">Logout</button>
  </div>

  <div class="card">
    <h3>Licenses</h3>
    <div id="licenses"></div>
  </div>
</div>

<script>
let TOKEN = "";

function login() {
  fetch("/auth/login", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      username:user.value,
      password:pass.value,
      totp:totp.value
    })
  }).then(r=>r.json()).then(d=>{
    if(!d.token){ alert(d.error); return; }
    TOKEN=d.token;
    load();
  });
}

function load(){
  fetch("/dashboard/data",{
    headers:{ Authorization:"Bearer "+TOKEN }
  }).then(r=>r.json()).then(d=>{
    loginCard.classList.add("hidden");
    dashboard.classList.remove("hidden");
    uName.innerText=d.user.username;
    uRole.innerText=d.user.role;
    licenses.innerHTML=d.licenses.map(l=>`<div>${l.product.name} - ${l.key}</div>`).join("");
  });
}

function logout(){
  TOKEN="";
  dashboard.classList.add("hidden");
  loginCard.classList.remove("hidden");
}
</script>

</body>
</html>
